# 项目架构图 (Project Architecture Diagram)

## 系统层次结构 (System Hierarchy)

```
┌─────────────────────────────────────────────────────────────┐
│                      GameController                          │
│                    (Main Game Loop)                          │
└────────────┬────────────────────────────────────────────────┘
             │
    ┌────────┴────────┬────────────────┬──────────────┐
    │                 │                │              │
    ▼                 ▼                ▼              ▼
┌─────────┐   ┌───────────────┐   ┌──────────┐  ┌──────────┐
│Operation│   │   BattleField │   │ Reward   │  │  Unit    │
│  Table  │   │  Controller   │   │Controller│  │Inventory │
└────┬────┘   └───────┬───────┘   └──────────┘  └──────────┘
     │                │
     │                │
     ▼                ▼
┌─────────┐      ┌─────────┐
│ Tetri   │      │  Unit   │
│Inventory│      │ Manager │
└─────────┘      └────┬────┘
                      │
                      ▼
                 ┌─────────┐
                 │  Units  │
                 │ Factory │
                 └─────────┘
```

## 游戏流程图 (Game Flow)

```
┌──────────────┐
│  游戏开始     │
│  Game Start  │
└──────┬───────┘
       │
       ▼
┌──────────────────────────────────────┐
│  准备阶段 (Preparation Phase)         │
│  ┌────────────────────────────────┐  │
│  │ 1. 从仓库选择 Tetri             │  │
│  │    Select Tetri from Inventory │  │
│  └────────────────────────────────┘  │
│  ┌────────────────────────────────┐  │
│  │ 2. 拖拽到操作台                 │  │
│  │    Drag to Operation Table     │  │
│  └────────────────────────────────┘  │
│  ┌────────────────────────────────┐  │
│  │ 3. 摆放和旋转 Tetri             │  │
│  │    Place and Rotate Tetri      │  │
│  └────────────────────────────────┘  │
│  ┌────────────────────────────────┐  │
│  │ 4. 配置 Unit 属性和技能         │  │
│  │    Configure Unit               │  │
│  └────────────────────────────────┘  │
└──────────────┬───────────────────────┘
               │
               ▼
┌──────────────────────────────────────┐
│  战斗阶段 (Battle Phase)              │
│  ┌────────────────────────────────┐  │
│  │ 1. 生成战斗单位                 │  │
│  │    Generate Units              │  │
│  └────────────────────────────────┘  │
│  ┌────────────────────────────────┐  │
│  │ 2. 自动移动寻敌                 │  │
│  │    Auto Move & Find Enemies    │  │
│  └────────────────────────────────┘  │
│  ┌────────────────────────────────┐  │
│  │ 3. 自动攻击                     │  │
│  │    Auto Attack                 │  │
│  └────────────────────────────────┘  │
│  ┌────────────────────────────────┐  │
│  │ 4. 自动释放技能                 │  │
│  │    Auto Cast Skills            │  │
│  └────────────────────────────────┘  │
│  ┌────────────────────────────────┐  │
│  │ 5. 统计战斗数据                 │  │
│  │    Collect Battle Statistics   │  │
│  └────────────────────────────────┘  │
└──────────────┬───────────────────────┘
               │
               ▼
┌──────────────────────────────────────┐
│  奖励阶段 (Reward Phase)              │
│  ┌────────────────────────────────┐  │
│  │ 1. 显示战斗结果                 │  │
│  │    Show Battle Results         │  │
│  └────────────────────────────────┘  │
│  ┌────────────────────────────────┐  │
│  │ 2. 选择奖励                     │  │
│  │    Choose Rewards              │  │
│  └────────────────────────────────┘  │
│  ┌────────────────────────────────┐  │
│  │ 3. 获得新 Tetri/升级            │  │
│  │    Get New/Upgrade Tetri       │  │
│  └────────────────────────────────┘  │
└──────────────┬───────────────────────┘
               │
               ▼
┌──────────────────┐
│  下一关或结束     │
│  Next Level/End  │
└──────────────────┘
```

## MVC 架构详解 (MVC Architecture Detail)

```
┌─────────────────────────────────────────────────────────────┐
│                          Controller                          │
│  (处理用户输入、协调 Model 和 View)                          │
│                                                              │
│  • GameController                                           │
│  • OperationTableController                                 │
│  • TetriInventoryController                                 │
│  • BattleFieldController                                    │
│  • UnitManager                                              │
└──────────────────┬────────────────┬─────────────────────────┘
                   │                │
        ┌──────────┘                └──────────┐
        │                                      │
        ▼                                      ▼
┌─────────────────┐                  ┌─────────────────┐
│     Model       │                  │      View       │
│  (数据和逻辑)    │                  │  (显示和渲染)    │
│                 │                  │                 │
│ • Tetri         │◄─────────────────┤ • TetriPrefab   │
│ • Cell          │                  │ • UI Elements   │
│ • Unit          │                  │ • Animations    │
│ • Attributes    │                  │ • Effects       │
│ • Skills        │                  │                 │
│ • InventoryModel│                  │                 │
└─────────────────┘                  └─────────────────┘
```

## 技能系统架构 (Skill System Architecture)

```
┌─────────────────────────────────────────────────────┐
│                    Skill System                     │
└─────────────────────────────────────────────────────┘
                         │
        ┌────────────────┼────────────────┐
        │                │                │
        ▼                ▼                ▼
┌──────────────┐  ┌──────────────┐  ┌──────────────┐
│ Active Skills│  │Passive Skills│  │   Buffs      │
└──────┬───────┘  └──────┬───────┘  └──────┬───────┘
       │                 │                 │
       │                 │                 │
   ┌───┴────┬────┬───┐   │         ┌──────┴─────┐
   │        │    │   │   │         │            │
   ▼        ▼    ▼   ▼   ▼         ▼            ▼
┌────┐  ┌────┐ ┌──┐ ┌──┐ ┌──────┐ ┌──────┐ ┌──────┐
│火系│  │冰系│ │生│ │风│ │影系  │ │突进系│ │混沌系│
│Fire│  │Ice │ │命│ │系│ │Shadow│ │Dash  │ │Chaos │
└────┘  └────┘ └──┘ └──┘ └──────┘ └──────┘ └──────┘
  │       │     │    │      │        │        │
  │       │     │    │      │        │        │
  ▼       ▼     ▼    ▼      ▼        ▼        ▼
┌─────────────────────────────────────────────────┐
│            各派系的具体技能实现                   │
│  • 单体攻击 (Single Target)                     │
│  • 范围攻击 (AoE)                               │
│  • 持续伤害 (DoT)                               │
│  • 控制效果 (CC)                                │
│  • 增益/减益 (Buff/Debuff)                      │
└─────────────────────────────────────────────────┘
```

## Tetri 构建系统 (Tetri Building System)

```
┌──────────────────────────────────────────────────────┐
│              Tetri Inventory (仓库)                  │
│  ┌────┐ ┌────┐ ┌────┐ ┌────┐ ┌────┐                │
│  │ T  │ │ L  │ │ O  │ │ I  │ │ S  │  ... (more)   │
│  └────┘ └────┘ └────┘ └────┘ └────┘                │
└──────────────────────────────────────────────────────┘
                    │ Drag & Drop
                    ▼
┌──────────────────────────────────────────────────────┐
│         Operation Table (10×10 网格)                 │
│                                                      │
│  ┌─┬─┬─┬─┬─┬─┬─┬─┬─┬─┐                             │
│  │ │ │ │ │ │ │ │ │ │ │                             │
│  ├─┼─┼─┼─┼─┼─┼─┼─┼─┼─┤                             │
│  │ │█│█│ │ │ │ │ │ │ │  █ = Character Tetri       │
│  ├─┼─┼─┼─┼─┼─┼─┼─┼─┼─┤  ▓ = Ability Tetri          │
│  │ │█│▓│▓│ │ │ │ │ │ │                             │
│  ├─┼─┼─┼─┼─┼─┼─┼─┼─┼─┤                             │
│  │ │ │▓│ │ │ │ │ │ │ │                             │
│  ├─┼─┼─┼─┼─┼─┼─┼─┼─┼─┤                             │
│  │ │ │ │ │ │ │ │ │ │ │                             │
│  └─┴─┴─┴─┴─┴─┴─┴─┴─┴─┘                             │
└──────────────────┬───────────────────────────────────┘
                   │ Build Unit
                   ▼
┌──────────────────────────────────────────────────────┐
│                 Battle Unit                          │
│  ┌────────────────────────────────────────────┐     │
│  │  Character (from Character Tetri)          │     │
│  │  + Attributes (from surrounding Cells)     │     │
│  │  + Skills (from ability Cells)             │     │
│  │  = Final Unit with customized abilities    │     │
│  └────────────────────────────────────────────┘     │
└──────────────────────────────────────────────────────┘
```

## 事件流动图 (Event Flow Diagram)

```
     User Action
         │
         ▼
┌────────────────┐
│  UI/Input      │
│  Events        │
└────────┬───────┘
         │ Event
         ▼
┌────────────────┐      Update      ┌────────────────┐
│  Controller    │─────────────────►│     Model      │
└────────┬───────┘                  └────────┬───────┘
         │                                   │
         │ Notify                            │ Changed Event
         │                                   │
         ▼                                   ▼
┌────────────────┐                  ┌────────────────┐
│     View       │◄─────────────────│  Other         │
│  (Refresh)     │     Event        │  Controllers   │
└────────────────┘                  └────────────────┘
```

## 战斗数据流 (Battle Data Flow)

```
┌─────────────┐
│   Units     │ (Player & Enemy)
└──────┬──────┘
       │
       ▼
┌─────────────────────────────────┐
│     Unit Manager                │
│  • Track all units              │
│  • Handle death                 │
│  • Emit events                  │
└──────┬──────────────────────────┘
       │
       ├──►┌────────────────┐
       │   │ Battle Stats   │ (Damage tracking)
       │   └────────────────┘
       │
       ├──►┌────────────────┐
       │   │ Skill System   │ (Skill casting)
       │   └────────────────┘
       │
       ├──►┌────────────────┐
       │   │ Buff System    │ (Status effects)
       │   └────────────────┘
       │
       └──►┌────────────────┐
           │ Combat Log     │ (Event history)
           └────────────────┘
```

## 技术栈 (Technology Stack)

```
┌─────────────────────────────────────────────────────┐
│                    Unity Engine                      │
│                   (2022.3.48t1)                      │
└─────────────────────────────────────────────────────┘
                       │
        ┌──────────────┼──────────────┐
        │              │              │
        ▼              ▼              ▼
┌─────────────┐ ┌────────────┐ ┌────────────┐
│   C# Code   │ │  Sprites   │ │  Prefabs   │
│ (11,806行)  │ │  (Pixel)   │ │  (Assets)  │
└─────────────┘ └────────────┘ └────────────┘
        │              │              │
        └──────────────┼──────────────┘
                       │
                       ▼
        ┌──────────────────────────┐
        │  WeChat Mini Program     │
        │  (Target Platform)       │
        └──────────────────────────┘
```

---

**说明**: 此架构图展示了项目的主要组件及其关系。实际实现可能更复杂，但这里展示了核心结构。

**Note**: This diagram shows the main components and their relationships. The actual implementation may be more complex, but this illustrates the core structure.
